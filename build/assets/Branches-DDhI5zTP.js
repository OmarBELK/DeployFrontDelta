import{R as A,r,j as e,L as T,D as L,M as g,C as D,a as I,B as V,H as F,E as P,S as R,T as q,e as H,f as K}from"./index-DoJY8-2y.js";function $({branch:i,onClose:d}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nom de la filiale"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:i.nom_filiere})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:i.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date de création"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:new Date(i.created_at).toLocaleDateString()})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{onClick:d,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Fermer"})})]})}function z(){const[i,d]=A.useState(!1),[N,h]=r.useState(!1),[v,f]=r.useState(!1),[w,p]=r.useState(!1),[n,o]=r.useState(null),[u,m]=r.useState([]);r.useState(!1);const[x,b]=r.useState(null),S=[{header:"Nom de la filiale",accessorKey:"nom_filiere",cell:({row:s})=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs",children:s.original.nom_filiere})},{header:"Description",accessorKey:"description"},{header:"Date de création",accessorKey:"created_at",cell:({row:s})=>new Date(s.original.created_at).toLocaleDateString()},{header:"Actions",id:"actions",cell:({row:s})=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>{var l,t;return(t=(l=s.original).onView)==null?void 0:t.call(l,s.original)},className:"p-1 text-blue-600 hover:text-blue-800",children:e.jsx(P,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{var l,t;return(t=(l=s.original).onEdit)==null?void 0:t.call(l,s.original)},className:"p-1 text-gray-600 hover:text-gray-800",children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>b(s.original.id),className:"p-1 text-gray-600 hover:text-gray-800",children:e.jsx(q,{className:"w-4 h-4"})})]})}];r.useEffect(()=>{fetch("http://162.19.205.65:81/filiere_list/").then(s=>{if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return s.json()}).then(s=>{m(s),d(!1)}).catch(s=>{d(!1)})},[x]);const C=s=>{({...s,created_at:new Date().toISOString()})},k=s=>{if(!n)return;const l=u.map(t=>t.id===n.id?{...t,...s}:t);m(l)},B=s=>{o(s),p(!0)},E=s=>{o(s),f(!0)},O=u.map(s=>({...s,onView:B,onEdit:E}));if(i)return e.jsx(T,{});function j({onSubmit:s,onClose:l,initialData:t}){const[a,y]=r.useState({nom_filiere:(t==null?void 0:t.nom_filiere)||"",description:(t==null?void 0:t.description)||""}),_=async c=>{c.preventDefault();const M=t?await K(a,t==null?void 0:t.id):await H(a);m([...u,M]),s(a),l()};return e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nom de la filiale"}),e.jsx("input",{type:"text",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",value:a.nom_filiere,onChange:c=>y({...a,nom_filiere:c.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{required:!0,rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",value:a.description,onChange:c=>y({...a,description:c.target.value})})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Annuler"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:t?"Mettre à jour la filiale":"Ajouter une filiale"})]})]})}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Filiales"}),e.jsx("button",{onClick:()=>h(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Ajouter une filiale"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx(L,{columns:S,data:O,searchPlaceholder:"Rechercher les filiales..."})}),e.jsx(g,{isOpen:N,onClose:()=>h(!1),title:"Ajouter une filiale",children:e.jsx(j,{onSubmit:C,onClose:()=>h(!1)})}),e.jsx(g,{isOpen:v,onClose:()=>{f(!1),o(null)},title:"Mettre à jour la filiale",children:n&&e.jsx(j,{onSubmit:k,onClose:()=>{f(!1),o(null)},initialData:n})}),e.jsx(g,{isOpen:w,onClose:()=>{p(!1),o(null)},title:"Détails de la filiale",children:n&&e.jsx($,{branch:n,onClose:()=>{p(!1),o(null)}})}),e.jsx(D,{isOpen:x!==null,onConfirm:async()=>{try{await I.delete(`http://162.19.205.65:81/filieres/delete/${x}/`,{headers:{"Content-Type":"application/json"}}),m(u.filter(s=>s.id!==x)),b(null),V.error("Supprimé avec succès",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light",transition:F})}catch(s){console.error("Error deleting branch:",s)}},onCancel:()=>b(null),message:"Êtes-vous sûr de vouloir supprimer cette filiale ?"})]})}export{z as default};
