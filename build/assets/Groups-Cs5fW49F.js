import{r as c,j as e,L as X,D as z,M,C as J,a as Q,B as V,H as Z,U as D,S as ee,T as se,i as re,X as te,k as ne,l as ie,m as ae,n as oe,o as ce,p as le}from"./index-DoJY8-2y.js";function he(){const[A,pe]=c.useState(!1),[E,x]=c.useState(!1),[u,h]=c.useState([]),[b,B]=c.useState(null),[L,g]=c.useState(!1);c.useState(!1);const[f,j]=c.useState(null),T=[{header:"Group Name",accessorKey:"nom_groupe",cell:({row:r})=>e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-600 block",children:r.original.nom_groupe}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Created ",new Date(r.original.created_at).toLocaleDateString()]})]})},{header:"Level & Branch",id:"level_branch",cell:({row:r})=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs block w-fit",children:r.original.niveau.nom_niveau}),e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs block w-fit",children:r.original.filiere.nom_filiere})]})},{header:"Subscription Price",accessorKey:"prix_subscription",cell:({row:r})=>{var n;return e.jsxs("span",{className:"font-medium text-green-600",children:["$",((n=r.original.prix_subscription)==null?void 0:n.toLocaleString())||0]})}},{header:"Capacity",id:"capacity",cell:({row:r})=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(D,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:r.original.max_etudiants})]}),e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs",children:"Max Students"})]})},{header:"Teachers & Commissions",id:"teachers",cell:({row:r})=>e.jsx("div",{className:"space-y-2",children:r.original.professeurs.map(n=>e.jsxs("div",{className:"flex items-center justify-between text-sm border-b pb-1 last:border-0",children:[e.jsxs("span",{className:"font-medium",children:[n.prenom," ",n.nom]}),e.jsxs("span",{className:"text-green-600 font-medium",children:["$",n.commission_fixe]})]},n.id))})},{header:"Subjects",accessorKey:"matieres",cell:({row:r})=>e.jsx("div",{className:"flex flex-wrap gap-1",children:r.original.matieres.map(n=>e.jsx("span",{className:"inline-block px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs",children:n.nom_matiere},n.id))})},{header:"Actions",id:"actions",cell:({row:r})=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>{var n,t;return(t=(n=r.original)==null?void 0:n.onEdit)==null?void 0:t.call(n,r.original)},className:"p-1 text-gray-600 hover:text-gray-800",children:e.jsx(ee,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>j(r.original.id),className:"p-1 text-gray-600 hover:text-gray-800",children:e.jsx(se,{className:"w-4 h-4"})})]})}];c.useEffect(()=>{(async()=>{try{const n=await re();h(n)}catch(n){console.error("Error fetching groups:",n)}})()},[f]);const P=r=>{var n,t;r.id,r.nom_groupe,r.niveau,(n=de.find(i=>i.id===r.niveau))!=null&&n.nom_niveau,r.filiere,(t=ue.find(i=>i.id===r.filiere))!=null&&t.nom_filiere,r.max_etudiants,r.prix_subscription,r.professeurs.map(i=>{var l,m;return{...i,nom:((l=G.find(p=>p.id===i.id))==null?void 0:l.nom)||"",prenom:((m=G.find(p=>p.id===i.id))==null?void 0:m.prenom)||""}}),r.matieres.map(i=>{var l;return{...i,nom_matiere:((l=me.find(m=>m.id===i.id))==null?void 0:l.nom_matiere)||""}}),new Date().toISOString(),x(!1)};if(A)return e.jsx(X,{});const F=r=>{B(r),g(!0)},O=r=>{if(!b)return;const n=u==null?void 0:u.map(t=>t.id===b.id?{...t,...r}:t);h(n)},I=u==null?void 0:u.map(r=>({...r,onEdit:F}));function y({onSubmit:r,onClose:n,initialData:t}){var w,k;const[i,l]=c.useState({nom_groupe:(t==null?void 0:t.nom_groupe)||"",niveau:((w=t==null?void 0:t.niveau)==null?void 0:w.id)||0,filiere:((k=t==null?void 0:t.filiere)==null?void 0:k.id)||0,max_etudiants:(t==null?void 0:t.max_etudiants)||30,prix_subscription:(t==null?void 0:t.prix_subscription)||0,professeurs:(t==null?void 0:t.professeurs)||[],matieres:(t==null?void 0:t.matieres)||[]}),[m,p]=c.useState([]),[U,v]=c.useState([]),[K,N]=c.useState([]),[$,_]=c.useState([]);c.useEffect(()=>{const s={levels:[{id:1,nom_niveau:"2BAC",description:"2BAC description"},{id:2,nom_niveau:"1BAC",description:"1BAC Sciences"}],branches:[{id:1,nom_filiere:"Sciences Mathematiques",description:"Filiere de Sciences Mathematiques"},{id:2,nom_filiere:"Sciences Physiques",description:"Filiere specialisée en physique et chimie"}],subjects:[{id:1,nom_matiere:"Mathematique",description:"Matiere Mathematique"},{id:2,nom_matiere:"Physiques",description:"Sciences physiques et expériences"}],teachers:[{id:1,nom:"Amrani",prenom:"Youssef",specialite:"Mathematique"},{id:2,nom:"Benali",prenom:"Fatima",specialite:"Physique"}]};p(s.levels),v(s.branches),N(s.subjects),_(s.teachers)},[]),c.useEffect(()=>{(async()=>{const a=await ne();v(a)})()},[]),c.useEffect(()=>{(async()=>{const a=await ie();N(a)})()},[]),c.useEffect(()=>{(async()=>{const a=await ae();p(a)})()},[]),c.useEffect(()=>{(async()=>{const a=await oe();_(a)})()},[]);const H=async s=>{s.preventDefault();const a=t?await le(i,t==null?void 0:t.id):await ce(i);h(o=>[...o,a]),r(i),n()},R=()=>{l(s=>({...s,professeurs:[...s.professeurs,{id:0,commission_fixe:150}]}))},Y=s=>{l(a=>({...a,professeurs:a.professeurs.filter((o,d)=>d!==s)}))},S=(s,a,o)=>{l(d=>({...d,professeurs:d.professeurs.map((q,W)=>W===s?{...q,[a]:o}:q)}))},C=s=>{l(a=>({...a,matieres:s.map(o=>({id:o}))}))};return e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Group Name"}),e.jsx("input",{type:"text",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",value:i.nom_groupe,onChange:s=>l({...i,nom_groupe:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Level"}),e.jsxs("select",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",value:i.niveau||"",onChange:s=>l({...i,niveau:Number(s.target.value)}),children:[e.jsx("option",{value:"",children:"Select a level"}),m.map(s=>e.jsx("option",{value:s.id,children:s.nom_niveau},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Branch"}),e.jsxs("select",{required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",value:i.filiere||"",onChange:s=>l({...i,filiere:Number(s.target.value)}),children:[e.jsx("option",{value:"",children:"Select a branch"}),U.map(s=>e.jsx("option",{value:s.id,children:s.nom_filiere},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Max Students"}),e.jsx("input",{type:"number",required:!0,min:"1",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",value:i.max_etudiants,onChange:s=>l({...i,max_etudiants:parseInt(s.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subscription Price"}),e.jsx("input",{type:"number",required:!0,min:"0",step:"0.01",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",value:i.prix_subscription,onChange:s=>l({...i,prix_subscription:parseFloat(s.target.value)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Teachers"}),e.jsx("button",{type:"button",onClick:R,className:"text-sm text-blue-600 hover:text-blue-700",children:"+ Add Teacher"})]}),e.jsx("div",{className:"space-y-2",children:i.professeurs.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded-lg",children:[e.jsxs("select",{required:!0,className:"flex-1 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",value:s.id||"",onChange:o=>S(a,"id",Number(o.target.value)),children:[e.jsx("option",{value:"",children:"Select a teacher"}),$.map(o=>e.jsxs("option",{value:o.id,children:[o.prenom," ",o.nom," - ",o.specialite]},o.id))]}),e.jsx("input",{type:"number",required:!0,min:"0",step:"0.01",placeholder:"Commission",className:"w-32 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",value:s.commission_fixe||"",onChange:o=>S(a,"commission_fixe",Number(o.target.value))}),e.jsx("button",{type:"button",onClick:()=>Y(a),className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(te,{className:"w-4 h-4"})})]},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Subjects"}),e.jsx("div",{className:"space-y-2",children:K.map(s=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500",checked:i.matieres.some(a=>a.id===s.id),onChange:a=>{const o=i.matieres.map(d=>d.id);a.target.checked?C([...o,s.id]):C(o.filter(d=>d!==s.id))}}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:s.nom_matiere})]},s.id))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:t?"Update Group":"Add Group"})]})]})}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Groups"}),e.jsx("button",{onClick:()=>x(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Add Group"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx(z,{columns:T,data:I,searchPlaceholder:"Search groups..."})}),e.jsx(M,{isOpen:E,onClose:()=>x(!1),title:"Add New Group",children:e.jsx(y,{onSubmit:P,onClose:()=>x(!1)})}),e.jsx(M,{isOpen:L,onClose:()=>g(!1),title:"Update Group",children:b&&e.jsx(y,{onSubmit:O,onClose:()=>g(!1),initialData:b})}),e.jsx(J,{isOpen:f!==null,onConfirm:async()=>{try{await Q.delete(`http://162.19.205.65:81/groupes/delete/${f}/`,{headers:{"Content-Type":"application/json"}}),h(u.filter(r=>r.id!==f)),j(null),V.error("Deleted Successfully",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light",transition:Z})}catch(r){console.error("Error deleting group:",r)}},onCancel:()=>j(null),message:"Do you really want to delete this group?"})]})}const de=[{id:1,nom_niveau:"2BAC",description:"2BAC description"},{id:2,nom_niveau:"1BAC",description:"1BAC Sciences"}],ue=[{id:1,nom_filiere:"Sciences Mathematiques",description:"Filiere de Sciences Mathematiques"},{id:2,nom_filiere:"Sciences Physiques",description:"Filiere specialisée en physique et chimie"}],me=[{id:1,nom_matiere:"Mathematique",description:"Matiere Mathematique"},{id:2,nom_matiere:"Physiques",description:"Sciences physiques et expériences"}],G=[{id:1,nom:"Amrani",prenom:"Youssef",specialite:"Mathematique"},{id:2,nom:"Benali",prenom:"Fatima",specialite:"Physique"}];export{he as default};
