import{R as T,r,j as e,L as D,D as I,M as b,C as P,a as V,B as y,H,E as K,S as R,T as q,b as B,d as F}from"./index-DoJY8-2y.js";function $({level:i,onClose:u}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nom du niveau"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:i.nom_niveau})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:i.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date de création"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:new Date(i.created_at).toLocaleDateString()})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{onClick:u,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Fermer"})})]})}function z(){const[i,u]=T.useState(!1),[N,h]=r.useState(!1),[w,p]=r.useState(!1),[C,g]=r.useState(!1),[o,c]=r.useState(null),[n,m]=r.useState([]);r.useState(!1);const[x,v]=r.useState(null),S=[{header:"ID",accessorKey:"id"},{header:"Nom du niveau",accessorKey:"nom_niveau",cell:({row:s})=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs",children:s.original.nom_niveau})},{header:"Description",accessorKey:"description"},{header:"Date de création",accessorKey:"created_at",cell:({row:s})=>new Date(s.original.created_at).toLocaleDateString()},{header:"Actions",id:"actions",cell:({row:s})=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>{var a,t;return(t=(a=s.original).onView)==null?void 0:t.call(a,s.original)},className:"p-1 text-blue-600 hover:text-blue-800",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{var a,t;return(t=(a=s.original).onEdit)==null?void 0:t.call(a,s.original)},className:"p-1 text-gray-600 hover:text-gray-800",children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>v(s.original.id),className:"p-1 text-gray-600 hover:text-gray-800",children:e.jsx(q,{className:"w-4 h-4"})})]})}];r.useEffect(()=>{fetch("http://162.19.205.65:81/niveau_list/").then(s=>{if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return s.json()}).then(s=>{m(s),u(!1)}).catch(s=>{u(!1)})},[x]);const L=s=>{({...s,created_at:new Date().toISOString()})},k=s=>{if(!o)return;const a=n==null?void 0:n.map(t=>t.id===o.id?{...t,...s}:t);m(a)},O=s=>{c(s),g(!0)},E=s=>{c(s),p(!0)},_=n==null?void 0:n.map(s=>({...s,onView:O,onEdit:E}));if(i)return e.jsx(D,{});function j({onSubmit:s,onClose:a,initialData:t}){const[l,f]=r.useState({nom_niveau:(t==null?void 0:t.nom_niveau)||"",description:(t==null?void 0:t.description)||""}),M=async d=>{d.preventDefault();const A=t?await F(l,t==null?void 0:t.id):await B(l);m([...n,A]),s(l),a()};return e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nom du niveau"}),e.jsx("input",{type:"text",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",value:l.nom_niveau,onChange:d=>f({...l,nom_niveau:d.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{required:!0,rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",value:l.description,onChange:d=>f({...l,description:d.target.value})})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Annuler"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:t?"Mettre à jour le niveau":"Ajouter un niveau"})]})]})}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Niveaux"}),e.jsx("button",{onClick:()=>h(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Ajouter un niveau"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx(I,{columns:S,data:_,searchPlaceholder:"Rechercher des niveaux..."})}),e.jsx(b,{isOpen:N,onClose:()=>h(!1),title:"Ajouter un niveau",children:e.jsx(j,{onSubmit:L,onClose:()=>h(!1)})}),e.jsx(b,{isOpen:w,onClose:()=>{p(!1),c(null)},title:"Mettre à jour le niveau",children:o&&e.jsx(j,{onSubmit:k,onClose:()=>{p(!1),c(null)},initialData:o})}),e.jsx(b,{isOpen:C,onClose:()=>{g(!1),c(null)},title:"Détails du niveau",children:o&&e.jsx($,{level:o,onClose:()=>{g(!1),c(null)}})}),e.jsx(P,{isOpen:x!==null,onConfirm:async()=>{try{await V.delete(`http://162.19.205.65:81/niveaux/delete/${x}/`,{headers:{"Content-Type":"application/json"}}),m(n.filter(s=>s.id!==x)),v(null),y.error("Supprimé avec succès",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light",transition:H})}catch(s){console.error("Error deleting level:",s),y.error("Échec de la suppression",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}},onCancel:()=>v(null),message:"Êtes-vous sûr de vouloir supprimer ce niveau ? Cette action ne peut pas être annulée."})]})}export{z as default};
