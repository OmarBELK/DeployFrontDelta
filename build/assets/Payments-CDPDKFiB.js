import{r,j as e,L as M,D as A,M as f,P as T,q as D,s as L}from"./index-DoJY8-2y.js";const k=[{header:"Student",accessorFn:t=>`${t.etudiant.prenom} ${t.etudiant.nom}`,cell:({row:t})=>e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[t.original.etudiant.prenom," ",t.original.etudiant.nom]}),e.jsx("div",{className:"text-sm text-gray-500",children:t.original.groupe.nom_groupe})]})},{header:"Amount",accessorKey:"montant",cell:({row:t})=>e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:["$",t.original.montant.toLocaleString()]}),t.original.montant_total&&t.original.statut_paiement==="Partial"&&e.jsxs("div",{className:"text-sm text-gray-500",children:["of $",t.original.montant_total.toLocaleString()]})]})},{header:"Date",accessorKey:"date_paiement",cell:({row:t})=>new Date(t.original.date_paiement).toLocaleDateString()},{header:"Status",accessorKey:"statut_paiement",cell:({row:t})=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.original.statut_paiement==="PAID"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:t.original.statut_paiement})},{header:"Commission %",accessorKey:"commission_percentage",cell:({row:t})=>e.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs",children:[t.original.frais_inscription,"%"]})},{header:"Actions",id:"actions",cell:({row:t})=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>{var i,o;return(o=(i=t.original).onPrint)==null?void 0:o.call(i,t.original)},className:"p-1 text-gray-600 hover:text-gray-800",title:"Print payment",children:e.jsx(D,{className:"w-4 h-4"})}),t.original.statut_paiement==="PARTIAL"&&e.jsx("button",{onClick:()=>{var i,o;return(o=(i=t.original).onCompletePayment)==null?void 0:o.call(i,t.original)},className:"p-1 text-blue-600 hover:text-blue-800",title:"Complete payment",children:e.jsx(L,{className:"w-4 h-4"})})]})}];function E({payment:t}){return e.jsxs("div",{className:"p-8 bg-white",id:"printable-payment",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Reçu de Paiement"}),e.jsxs("p",{className:"text-gray-500",children:["#",t.id]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold mb-2",children:"Informations de l'Étudiant"}),e.jsxs("p",{children:[t.etudiant.prenom," ",t.etudiant.nom]}),e.jsx("p",{children:t.etudiant.telephone}),e.jsx("p",{children:t.etudiant.adresse})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("h2",{className:"font-bold mb-2",children:"Détails du Paiement"}),e.jsxs("p",{children:["Date : ",new Date(t.date_paiement).toLocaleDateString()]}),e.jsxs("p",{children:["Statut : ",t.statut_paiement]}),e.jsxs("p",{children:["Groupe : ",t.groupe.nom_groupe]}),e.jsxs("p",{children:["Montant Restant : ",t.remaining," MAD"]})]})]}),e.jsxs("div",{className:"border-t border-b border-gray-200 py-4 mb-8",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"font-bold",children:"Montant Payé :"}),e.jsxs("span",{children:[t.montant.toLocaleString()," MAD"]})]}),t.montant_total&&t.statut_paiement==="Partiel"&&e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"font-bold",children:"Montant Total :"}),e.jsxs("span",{children:[t.montant_total.toLocaleString()," MAD"]})]})]}),e.jsxs("div",{className:"text-center text-sm text-gray-500",children:[e.jsx("p",{children:"Merci pour votre paiement !"}),e.jsx("p",{children:"Ceci est un document généré par ordinateur."})]})]})}const O=[{id:1,montant:500,montant_total:1e3,date_paiement:"2024-06-15T00:00:00Z",statut_paiement:"Partial",etudiant:{id:1,nom:"Doe",prenom:"John",date_naissance:"2003-01-01",telephone:"123456789011111",adresse:"123 Main St",sexe:"M",nationalite:"French",contact_urgence:"98765432101111111",created_at:"2024-10-25T19:14:26.603176Z"},groupe:{id:1,nom_groupe:"Pack Math et PC",niveau:1,max_etudiants:30,filiere:1,professeurs:[{id:1,nom:"Amrani",prenom:"Youssef",commission_fixe:150}],matieres:[{id:1,nom_matiere:"Mathematique"}],created_at:"2024-10-25T19:14:26.780492Z"},commission_percentage:50},{id:2,montant:800,date_paiement:"2024-06-20T00:00:00Z",statut_paiement:"Paid",etudiant:{id:2,nom:"Smith",prenom:"Emma",date_naissance:"2004-03-15",telephone:"987654321011111",adresse:"456 Oak Avenue",sexe:"F",nationalite:"English",contact_urgence:"12345678901111111",created_at:"2024-10-26T10:20:15.123456Z"},groupe:{id:2,nom_groupe:"Sciences de la Vie",niveau:2,max_etudiants:25,filiere:2,professeurs:[{id:2,nom:"Benani",prenom:"Sara",commission_fixe:140}],matieres:[{id:2,nom_matiere:"Biologie"}],created_at:"2024-10-26T10:20:15.123456Z"},commission_percentage:60}];function I(){const[t,i]=r.useState(!1),[o,d]=r.useState(!1),[b,m]=r.useState(!1),[n,l]=r.useState(null),[j,c]=r.useState([]),[y,u]=r.useState(O.reduce((a,s)=>a+s.montant,0)),p=async()=>{try{i(!0);const a=await fetch("http://162.19.205.65:81/paiements/?ordering=-date_paiement");if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const s=await a.json();c(s.results),u(s.results.reduce((x,h)=>x+h.montant,0))}catch(a){console.error("Error fetching payments:",a)}finally{i(!1)}};r.useEffect(()=>{p()},[]);const _=a=>{l(a),m(!0)},N=a=>{a.montant_total&&(l(a),d(!0))},P=async a=>{try{if(!(n!=null&&n.montant_total))return;const s=n.montant_total-n.montant;if(a.montant>s){alert(`The maximum remaining amount is $${s}`);return}if((await fetch("http://162.19.205.65:81/paiements/create/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok){const g=await(await fetch("http://162.19.205.65:81/paiements/")).json();c(g.results),u(g.results.reduce((C,w)=>C+w.montant,0)),d(!1),l(null),alert("Payment completed successfully")}else throw new Error("Failed to create payment")}catch(s){console.error("Error creating payment:",s),alert("Failed to complete payment")}},v=()=>{const a=document.getElementById("printable-payment");if(!a)return;const s=window.open("","_blank");s&&(s.document.write(`
      <html>
        <head>
          <title>Payment Receipt</title>
          <style>
            body {
              font-family: system-ui, -apple-system, sans-serif;
              line-height: 1.5;
              margin: 0;
              padding: 20px;
            }
            .print-content {
              max-width: 800px;
              margin: 0 auto;
            }
            .grid {
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 1rem;
            }
            .text-center { text-align: center; }
            .text-right { text-align: right; }
            .mb-8 { margin-bottom: 2rem; }
            .mb-2 { margin-bottom: 0.5rem; }
            .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
            .font-bold { font-weight: bold; }
            .text-2xl { font-size: 1.5rem; }
            .text-sm { font-size: 0.875rem; }
            .text-gray-500 { color: #6b7280; }
            .border-t { border-top: 1px solid #e5e7eb; }
            .border-b { border-bottom: 1px solid #e5e7eb; }
            @media print {
              body { print-color-adjust: exact; }
            }
          </style>
        </head>
        <body>
          ${a.outerHTML}
        </body>
      </html>
    `),s.document.close(),s.focus(),setTimeout(()=>{s.print(),s.close()},250))},S=j.map(a=>({...a,onPrint:_,onCompletePayment:N}));return t?e.jsx(M,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Payments"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Total amount: ",y.toLocaleString()," MAD"]})]}),e.jsx("button",{onClick:()=>d(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Add Payment"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx(A,{columns:k,data:S,searchPlaceholder:"Search payments..."})})]}),e.jsx(f,{isOpen:o,onClose:()=>{d(!1),l(null)},title:n?"Complete Payment":"Add New Payment",children:e.jsx(T,{fetch:p,id:n==null?void 0:n.id,onSubmit:P,onClose:()=>{d(!1),l(null)},initialStudentId:n==null?void 0:n.etudiant.id,students:[],groups:[n==null?void 0:n.groupe].filter(Boolean),isCompletion:!!n,remainingAmount:n!=null&&n.montant_total?n.montant_total-n.montant:void 0})}),e.jsx(f,{isOpen:b,onClose:()=>{m(!1),l(null)},title:"Print Payment",children:n&&e.jsxs("div",{children:[e.jsx(E,{payment:n}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6 no-print",children:[e.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:v,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:"Print"})]})]})})]})}export{I as default};
